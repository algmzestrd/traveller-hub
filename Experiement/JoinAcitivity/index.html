<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>无标题文档</title>
</head>

<body>

<span>+</span>

<button onclick="goodplus(1);">Join</button>

<script type="text/javascript">
	var span = document.getElementsByTagName('span');
	var num;
	var flag = 0;
	
	for(var i = 1; i < span.length + 1; i++){
		senddata(i);	
	}
	
	function goodplus(gindex){
		flag = 1;
		num = parseInt(span.item(gindex-1).innerHTML);
		if(checkcookie(gindex) == true){
			num = num + 1;
			senddata(gindex);
		}else{
			alert("You have click the JOIN");	
		}
	}
	
	function senddata(aindex){
		var xmlhttp;
		var txt;
		if(window.XMLHttpRequest){
			xmlhttp=new XMLHttpRequest();
		}else{
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange=function(){
			if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
				txt = xmlhttp.responseText;
				var cookieindex = aindex - 1;
				document.getElementsByTagName('span').item(cookieindex).innerHTML = txt;
			}
		}
		xmlhttp.open("GET","/ajax/json/index.php?num=" + num + '&flag=' + flag + '&aindex=' + aindex,true);
		xmlhttp.send();
	}
	
	
	function checkcookie(gindex){
		var thiscookie = 'sdcity_foodmap_goodplus' + gindex;
		var mapcookie = getCookie(thiscookie)
		if (mapcookie!=null && mapcookie!=""){
			return false;
		}else {
			setCookie(thiscookie,thiscookie,365);
			return true;
		}	
	}
	
	
	function getCookie(c_name){               
		if (document.cookie.length > 0){               
			c_start = document.cookie.indexOf(c_name + "=");
			if (c_start != -1){
				c_start = c_start + c_name.length + 1 ;      
				c_end = document.cookie.indexOf(";" , c_start);
				if (c_end == -1) {
					c_end = document.cookie.length;
				}
				return unescape(document.cookie.substring(c_start , c_end));
			} 
		}
		return "";
	}
	
	function setCookie(c_name,value,expiredays)
	{
		var exdate=new Date();
		exdate.setDate( exdate.getDate() + expiredays )
		document.cookie = c_name + "=" + escape(value) + ((expiredays==null) ? "" : "; expires=" + exdate.toGMTString())
	}
</script>
</body>
</html>
